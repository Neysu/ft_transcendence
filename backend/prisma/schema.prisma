// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
}

model User {
  id           Int      @id @default(autoincrement())
  username     String   @unique
  email        String   @unique
  password     String
  profileImage String?  // URL ou path vers avatar
  profileText  String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  posts        Post[]
  sentMessages         Message[]   @relation("MessagesSent")
  receivedMessages     Message[]   @relation("MessagesReceived")
  sentFriendRequests     Friendship[] @relation("FriendRequestsSent")
  receivedFriendRequests Friendship[] @relation("FriendRequestsReceived")
}

model Game {
  id            Int      @id @default(autoincrement())
  playerOneId   Int
  playerTwoId   Int
  playerOneScore Int     @default(0)
  playerTwoScore Int     @default(0)
  round         Int      @default(1)
  status        GameStatus @default(ONGOING)
  rounds        Round[]
  createdAt     DateTime @default(now())
  finishedAt    DateTime?
}

enum GameStatus {
  ONGOING
  FINISHED
}

model Round {
  id         Int      @id @default(autoincrement())
  gameId     Int
  roundNumber Int

  playerOneMove String?
  playerTwoMove String?

  winnerId   Int?

  game       Game @relation(fields: [gameId], references: [id])
}

model Post {
  id        Int      @id @default(autoincrement())
  title     String
  content   String
  author    User     @relation(fields: [authorId], references: [id])
  authorId  Int
  createdAt DateTime @default(now())
}

enum FriendshipStatus {
  PENDING
  ACCEPTED
  BLOCKED
}

model Friendship {
  id        Int      @id @default(autoincrement())
  requester   User             @relation("FriendRequestsSent", fields: [requesterId], references: [id])
  requesterId Int
  addressee   User             @relation("FriendRequestsReceived", fields: [addresseeId], references: [id])
  addresseeId Int
  status      FriendshipStatus @default(PENDING)
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt

  @@unique([requesterId, addresseeId])
  @@index([requesterId])
  @@index([addresseeId])
}

model Message {
  id         Int      @id @default(autoincrement())
  content    String
  createdAt  DateTime @default(now())
  deliveredAt DateTime?
  sender     User     @relation("MessagesSent", fields: [senderId], references: [id])
  senderId   Int
  receiver   User     @relation("MessagesReceived", fields: [receiverId], references: [id])
  receiverId Int

  @@index([senderId])
  @@index([receiverId])
  @@index([createdAt])
  @@index([deliveredAt])
}
